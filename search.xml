<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Apollo</title>
      <link href="/2019/12/31/Apollo/"/>
      <url>/2019/12/31/Apollo/</url>
      
        <content type="html"><![CDATA[<h3 id="服务器部署Apollo-单机，源码构建"><a href="#服务器部署Apollo-单机，源码构建" class="headerlink" title="服务器部署Apollo(单机，源码构建)"></a>服务器部署Apollo(单机，源码构建)</h3><h5 id="一-准备环境"><a href="#一-准备环境" class="headerlink" title="一. 准备环境"></a>一. 准备环境</h5><p>​        JDK 1.8</p><p>​        MYSQL 5.7</p><p>​        centOS 7.3</p><p>​        git 2.24</p><h5 id="二-Apollo源码获取"><a href="#二-Apollo源码获取" class="headerlink" title="二. Apollo源码获取"></a>二. Apollo源码获取</h5><p>进入将保存Apollo源码的文件，右击鼠标选择Git Bash Here后执行下面命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/ctripcorp/apollo.git</span><br></pre></td></tr></table></figure><p>解压之后打开会看见很多子项目，其中我们会操作的目前有三个</p><p>​    ① apollo-adminservice  配置管理，发布接口，服务于portal端图像化界面管理</p><p>​    ② apollo-configservice  配置获取接口，配置推送接口，服务于Apollo客户端(应用)</p><p>​    ③ apollo-portal 配置管理界面，获取adminservice服务列表</p><h5 id="三-数据库初始化"><a href="#三-数据库初始化" class="headerlink" title="三. 数据库初始化"></a>三. 数据库初始化</h5><p>打开Apollo源码，进入scripts\docker-quick-start\sql文件，将文件的的sql文件导入到MySQL(外网能访问的)中</p><p>​    apolloconfigdb.sql ，apolloportaldb.sql</p><p>导入之后会生成两个对应的数据库</p><h5 id="四-脚本修改"><a href="#四-脚本修改" class="headerlink" title="四. 脚本修改"></a>四. 脚本修改</h5><p>选择源码文件根目录scripts文件中的 build.bat或build.sh（选择其中之一即可）修改</p><p>build.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> apollo config db info</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在分布式部署中,config db有多个,每个环境都有单独的数据库，一个管理界面管理多个环境配置</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 所以不同环境打包需要修改为对应的数据库信息</span></span><br><span class="line">apollo_config_db_url=jdbc:mysql://数据库服务器IP:端口/ApolloConfigDB?characterEncoding=utf8</span><br><span class="line">apollo_config_db_username=用户名</span><br><span class="line">apollo_config_db_password=密码</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> apollo portal db info</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 管理项目数据库只修改一次就好</span></span><br><span class="line">apollo_portal_db_url=jdbc:mysql://数据库服务器IP:端口/ApolloPortalDB?characterEncoding=utf8</span><br><span class="line">apollo_portal_db_username=用户名</span><br><span class="line">apollo_portal_db_password=密码</span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置meta server url,也就是http://Apollo-configservice的IP:端口</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在对应环境上配置对应路径即可，这里只配置一个dev-meta</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> meta server url, different environments should have different meta server addresses</span></span><br><span class="line"><span class="meta">#</span><span class="bash">dev_meta=http://fill-in-dev-meta-server:8080</span></span><br><span class="line"><span class="meta">#</span><span class="bash">fat_meta=http://fill-in-fat-meta-server:8080</span></span><br><span class="line"><span class="meta">#</span><span class="bash">uat_meta=http://fill-in-uat-meta-server:8080</span></span><br><span class="line"><span class="meta">#</span><span class="bash">pro_meta=http://fill-in-pro-meta-server:8080</span></span><br><span class="line"></span><br><span class="line">dev_meta=http://服务器IP:端口</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这步不要忘记了</span></span><br><span class="line"><span class="meta">#</span><span class="bash">META_SERVERS_OPTS=<span class="string">"-Ddev_meta=<span class="variable">$dev_meta</span> -Dfat_meta=<span class="variable">$fat_meta</span> -Duat_meta=<span class="variable">$uat_meta</span> -Dpro_meta=<span class="variable">$pro_meta</span>"</span></span></span><br><span class="line">META_SERVERS_OPTS="-Ddev_meta=$dev_meta"</span><br></pre></td></tr></table></figure><p>注意：Apollo-adminservice 默认端口8090，Apollo-configservice默认端口8080，Apollo-portal默认8070</p><p>端口可修改，如果meta server url的端口不是8080，请记住端口，后面需要修改启动脚本文件</p><p>完成修改后执行修改后的脚本，进行打包</p><h5 id="五-部署"><a href="#五-部署" class="headerlink" title="五. 部署"></a>五. 部署</h5><p>进入源码根目录，获取上述三个项目的XXXXXX-github.zip包(项目的target目录下)上传服务器</p><p>在服务器上新建三个文件夹分别保存三个项目(mkdir 文件夹名)，解压项目</p><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip XXXXXX-github.zip</span><br></pre></td></tr></table></figure><p><a href="https://imgchr.com/i/llv5zF" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/12/31/llv5zF.md.png" alt="llv5zF.md.png"></a></p><p>如果需要修改端口，进入scripts文件 vi startup.sh</p><p>将SERVER_PORT 修改为指定端口即可</p><p>三个项目操作类同</p><p>修改ApolloConfigDB数据库的ServerConfig表中eureka.service.url的value</p><p><a href="http://apollo-configserviceIP:port/eureka/" target="_blank" rel="noopener">http://apollo-configserviceIP:port/eureka/</a></p><p>多个用英文逗号隔开。</p><p>先后执行configservice，adminservice，portal解压后scripts中的startup.sh</p><p>有点耗时，启动成功访问管理界面，默认是<a href="http://IP:8090" target="_blank" rel="noopener">http://IP:8090</a> ,账户：apollo，密码：admin</p><p>Apollo差不多完成</p><h5 id="六-客户端连接"><a href="#六-客户端连接" class="headerlink" title="六. 客户端连接"></a>六. 客户端连接</h5><p>创建spring boot项目 pom.xml 导入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ctrip.framework.apollo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>apollo-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>启动类添加注解 @EnableApolloConfig</p><p>配置文件 application.properties中</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">apollo.meta</span>=<span class="string">http://configservice的IP:端口</span></span><br><span class="line"><span class="comment">### apollo server的应用id</span></span><br><span class="line"><span class="meta">app.id</span>=<span class="string">testApp</span></span><br><span class="line"><span class="meta">apollo.bootstrap.enabled</span> = <span class="string">true</span></span><br></pre></td></tr></table></figure><p>搭建完成后启动客户端，系统会报连接超时什么的，无法获取配置</p><p>这是Apollo的安全机制，可以点击Apollo管理界面的 管理工具中的系统信息，其中的ip都是服务器的内外ip，外网无法正常访问</p><p>解决方法：</p><p>​    ①在idea的VM options参数添加 -Dapollo.configService=<a href="http://IP:端口" target="_blank" rel="noopener">http://IP:端口</a></p><p>​    ②修改adminservice，configservice的配置文件bootstrap.yml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">eureka:</span><br><span class="line">  instance:</span><br><span class="line">    homePageUrl: http://$&#123;指定的IP&#125;:$&#123;指定的Port&#125;</span><br><span class="line">    preferIpAddress: false</span><br></pre></td></tr></table></figure><p>注意冒号后需要空格(没有空格服务启动不了)</p><p>更多 <a href="https://github.com/ctripcorp/apollo/wiki/分布式部署指南" target="_blank" rel="noopener">分布式部署指南</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>docker安装Oracle</title>
      <link href="/2019/12/12/docker%E5%AE%89%E8%A3%85Oracle/"/>
      <url>/2019/12/12/docker%E5%AE%89%E8%A3%85Oracle/</url>
      
        <content type="html"><![CDATA[<h4 id="docker安装Oracle"><a href="#docker安装Oracle" class="headerlink" title="docker安装Oracle"></a>docker安装Oracle</h4><h5 id="docker常用命令"><a href="#docker常用命令" class="headerlink" title="docker常用命令"></a>docker常用命令</h5><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker images  查看镜像文件</span><br><span class="line">docker ps  查看正在运行的容器</span><br><span class="line">docker ps –a  查看所有的容器</span><br><span class="line">docker container <span class="keyword">exec</span> -it f0b1c8ab3633 /bin/bash  进入到容器</span><br><span class="line"><span class="keyword">exit</span> 退出</span><br><span class="line">docker version  查看版本</span><br><span class="line">docker run -d -p <span class="number">81</span>:<span class="number">80</span> nginx 启动nginx容器</span><br><span class="line">docker rmi imgageid 删除镜像</span><br><span class="line">docker rm 容器id 删除容器</span><br></pre></td></tr></table></figure><h6 id="1-获取镜像"><a href="#1-获取镜像" class="headerlink" title="1.获取镜像"></a>1.获取镜像</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull registry.cn-hangzhou.aliyuncs.com/helowin/oracle_11g</span><br></pre></td></tr></table></figure><p>查看镜像<img src="https://s2.ax1x.com/2019/12/12/Qyvd5F.png" alt="2019-12-12_14-36-14"></p><p>​    </p><h6 id="2-创建容器"><a href="#2-创建容器" class="headerlink" title="2.创建容器"></a>2.创建容器</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 1521:1521 --name oracle registry.cn-hangzhou.aliyuncs.com/helowin/oracle_11g</span><br></pre></td></tr></table></figure><p>​    查看所有容器：docker ps -a</p><p>​    查看运行时的容器：docker ps </p><p><img src="https://s2.ax1x.com/2019/12/12/QyxVG4.png" alt="2019-12-12_14-41-37"></p><h6 id="3-运行容器"><a href="#3-运行容器" class="headerlink" title="3.运行容器"></a>3.运行容器</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker start oracle</span><br></pre></td></tr></table></figure><h6 id="4-进入容器"><a href="#4-进入容器" class="headerlink" title="4.进入容器"></a>4.进入容器</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker exec -it oracle bash</span><br></pre></td></tr></table></figure><h6 id="5-配置环境-防止-sqlplus-command-not-fund"><a href="#5-配置环境-防止-sqlplus-command-not-fund" class="headerlink" title="5.配置环境(防止 sqlplus: command not fund)"></a>5.配置环境(防止 sqlplus: command not fund)</h6><p>​    切换到root(密码:helowin)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su root</span><br></pre></td></tr></table></figure><h6 id="6-编辑文件"><a href="#6-编辑文件" class="headerlink" title="6.编辑文件"></a>6.编辑文件</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/profile</span><br></pre></td></tr></table></figure><h6 id="7-末尾添加"><a href="#7-末尾添加" class="headerlink" title="7.末尾添加"></a>7.末尾添加</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export ORACLE_HOME=/home/oracle/app/oracle/product/11.2.0/dbhome_2</span><br><span class="line">export ORACLE_SID=helowin</span><br><span class="line">export PATH=$ORACLE_HOME/bin:$PATH</span><br></pre></td></tr></table></figure><h6 id="8-更新-etc-profile文件"><a href="#8-更新-etc-profile文件" class="headerlink" title="8.更新/etc/profile文件"></a>8.更新/etc/profile文件</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><h6 id="9-创建软连接"><a href="#9-创建软连接" class="headerlink" title="9.创建软连接"></a>9.创建软连接</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s $ORACLE_HOME/bin/sqlplus /usr/bin</span><br></pre></td></tr></table></figure><h6 id="10-切换到oracle-用户"><a href="#10-切换到oracle-用户" class="headerlink" title="10.切换到oracle 用户"></a>10.切换到oracle 用户</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su oracle</span><br></pre></td></tr></table></figure><h6 id="11-登录sqlplus并修改sys、system用户密码"><a href="#11-登录sqlplus并修改sys、system用户密码" class="headerlink" title="11.登录sqlplus并修改sys、system用户密码"></a>11.登录sqlplus并修改sys、system用户密码</h6><pre><code>sqlplus /nolog</code></pre><p>​    conn /as sysdba</p><pre><code>接着执行下面命令    alter user system identified by system;    alter user sys identified by sys;    也可以创建用户  create user test identified by test;      并给用户赋予权限  grant connect,resource,dba to test;</code></pre><h6 id="12-exit-是退出sql-软连接"><a href="#12-exit-是退出sql-软连接" class="headerlink" title="12.exit  是退出sql 软连接"></a>12.exit  是退出sql 软连接</h6><h6 id="13-配置-tnsnames-ora"><a href="#13-配置-tnsnames-ora" class="headerlink" title="13.配置 tnsnames.ora"></a>13.配置 <strong>tnsnames.ora</strong></h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /home/oracle/app/oracle/product/11.2.0/dbhome_2/network/admin/tnsnames.ora</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/12/12/Q68U6H.md.png" alt="2019-12-12_14-41-37"></p><p>宿主ip地址</p><h6 id="14-出现如下图片"><a href="#14-出现如下图片" class="headerlink" title="14.出现如下图片"></a>14.出现如下图片</h6><p><img src="https://s2.ax1x.com/2019/12/12/Q68c9S.png" alt="2019-12-12_16-17-14"></p><h6 id="15-这时我们需要去看一下oracle-的-lsnrctl-服务"><a href="#15-这时我们需要去看一下oracle-的-lsnrctl-服务" class="headerlink" title="15.这时我们需要去看一下oracle 的 lsnrctl 服务"></a>15.这时我们需要去看一下oracle 的 lsnrctl 服务</h6><p>​    查看状态：</p><p><img src="https://s2.ax1x.com/2019/12/12/Q6tQgO.png" alt="2019-12-12_16-39-33"></p><p>​    启动</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LSNRCTL&gt;start</span><br></pre></td></tr></table></figure><p>完成！！</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>mysql安装</title>
      <link href="/2019/12/08/mysql%E5%AE%89%E8%A3%85/"/>
      <url>/2019/12/08/mysql%E5%AE%89%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<h5>centOS 7.3(64位)新服务器 安装MySQL5.7  --yum方式</h5><ol><li><p>rpm -qa|grep -i mysql</p></li><li><p>用命令 yum -y remove</p><p>​      yum -y remove mysql-community-client-5.6.38-2.el7.x86_64</p><p>​      卸载不掉的用 rpm -ev </p><p>​      依次卸载 直到没有</p></li><li><p>操作rpm文件</p><p>wget  <a href="http://repo.mysql.com/mysql57-community-release-el7-8.noarch.rpm" target="_blank" rel="noopener">http://repo.mysql.com/mysql57-community-release-el7-8.noarch.rpm</a></p><p>rpm -ivh mysql57-community-release-el7-8.noarch.rpm</p></li><li><p>安装MySQL服务</p><p>yum -y install mysql-server</p><p>yum –installroot=/usr/local/mysql–releasever=/ -y install mysql-server（安装到指定目录）</p></li><li><p>配置  my.cnf        vim /etc/my.cnf</p><p>[mysqld]</p><p>#</p><p># Remove leading # and set to the amount of RAM for the most important data</p><p># cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.</p><p># innodb_buffer_pool_size = 128M</p><p>#</p><p># Remove leading # to turn on a very important data integrity option: logging</p><p># changes to the binary log between backups.</p><p># log_bin</p><p>#</p><p># Remove leading # to set options mainly useful for reporting servers.</p><p># The server defaults are faster for transactions and fast SELECTs.</p><p># Adjust sizes as needed, experiment to find the optimal values.</p><p># join_buffer_size = 128M</p><p># sort_buffer_size = 2M</p><p># read_rnd_buffer_size = 2M</p><p>datadir=/var/lib/mysql</p><p>socket=/var/lib/mysql/mysql.sock</p><p>server_id = 1</p><p>expire_logs_days = 3</p></li></ol><p>   # Disabling symbolic-links is recommended to prevent assorted security risks</p><p>   symbolic-links=0</p><p>   log-error=/var/log/mysqld.log</p><p>   pid-file=/var/run/mysqld/mysqld.pid</p><ol start="6"><li><p>启动mysql服务</p><p>service mysqld start</p></li><li><p>重置密码</p><p>grep “password” /var/log/mysqld.log    查看临时密码</p><p>或者<br>grep ‘temporary password’ /var/log/mysqld.log</p></li></ol><p>   需要重置密码要不什么也不能操作</p><p>   alter user ‘root’@’localhost’ identified by ‘IPyun20190729!+@=#’;  </p><p>   第一个参数：IP地址</p><p>   第二个参数：密码</p><p>   grant all on <em>.</em> to ‘root’@’%’ identified by ‘IPyun20190729!+@=#’  with grant option;</p><p>   第一个参数：数据库用户名（比如：root）</p><p>   第二个参数：数据库密码</p><p>   2、开放3306端口号</p><p>   firewalld 防火墙（centos-7）运行命令,并重启：</p><p>   firewall-cmd –zone=public –add-port=3306/tcp –permanent </p><p>   firewall-cmd –reload</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
